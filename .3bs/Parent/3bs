#!/bin/bash

if [ "$1" = "dev-test" ]; then
    shift
    set -xe
else
    set -e
fi

if [ "$(ps -p $$ -o comm=)" = "sh" ]
then
    # echo "This script does not support sh. Re-invoking with bash..."
    /bin/bash $0 $@
    exit $?
fi

source .3bs/Utility/3bs/*.sh

_Build() {
    echo "Building project..."
    echo "Arguments: $@"
    # Build logic here
}

_Test() {
    echo "Running tests..."
    echo "Arguments: $@"
    # Test logic here
}

_Help() {
    echo "Available commands:"
    echo "  build               Build the project"
    echo "  test                Run tests"
    echo "  help                Show this help message"
    echo "  clean               Clean build artifacts"
    echo "  update              Update dependencies"
    echo "  version             Show version information"
    echo "  get-dependencies    Get project dependencies"
}

_Clean() {
    echo "Cleaning project..."
    echo "Arguments: $@"
    # Clean logic here
}

_Update() {
    echo "Updating project..."
    echo "Arguments: $@"

    tmp=$(_CreateTempIfNotExists Update)


    # Update logic here
}

_Version() {
    echo "Project version: 1.0.0"
    # Version logic here
}

_GetDependencies() {
    echo "Retrieving dependencies..."
    echo "Arguments: $@"

    cat deps.json | handlerpath=".3bs/Asset" .3bs/Tool/get-dependencies
    # Get dependencies logic here
}

if [ "$1:0:1" == "_" ] || [ "$1" == "" ]; then
    echo "Command not found"
    exit 1
fi

case $1 in
    "build" )
        shift && _Build $@
        ;;
    "test" )
        shift && _Test $@
        ;;
    "help" )
        shift && _Help $@
        ;;
    "clean" )
        shift && _Clean $@
        ;;
    "update" )
        shift && _Update $@
        ;;
    "version" )
        shift && _Version $@
        ;;
    "get-dependencies" )
        shift && _GetDependencies $@
        ;;
    * )
        echo "Command not found"
        exit 1
        ;;
esac