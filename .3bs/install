#!/bin/bash

source *install.util.sh

set -e

source .3bs/*essential.sh

if [ "$1" = "dev-test" ]; then
    shift
    set -xe
fi

_DisplayTrace 'Installing 3bs into local directory...'

prohibit_git=false
for arg in "$@"; do
    [ "$arg" = "--prohibit-git" ] && \
        prohibit_git=true && break
done

cd $(dirname $0) # Typically .3bs
    git rev-parse HEAD > Asset/current.ver
    \cp Parent/. .. -far
    rm -fr Parent
cd -

rm LICENSE
rm README.md
rm devutil
rm -fr .git

printf "{\n}" > deps.json
mkdir Source

rm $0 # Remove this install script: typically .3bs/install

# Create a git repository if git is available.
if command -v git &> /dev/null && [ "$prohibit_git" = false ]
then
    _DisplayTrace "Initializing git repository..."
    git init . --quiet
    git add . --all
    git commit -m "Initial commit." --quiet
    _DisplayTrace "Git repository initialized."
else
    _DisplayInfo "Git not found, or has been prohibited; skipping git repository initialization."
fi


echo '3bs installed.'